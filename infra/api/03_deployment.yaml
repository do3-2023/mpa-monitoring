apiVersion: core.spinoperator.dev/v1alpha1
kind: SpinApp
metadata:
  name: api
  namespace: mpa-backend
spec:
  replicas: 1
  executor: containerd-shim-spin
  image: ghcr.io/do3-2023/do3-2023/mpa-monitoring/wasm:v5.0
  checks:
    liveness:
      httpGet:
        path: /healthz
        httpHeaders: []
      initialDelaySeconds: 15
      timeoutSeconds: 3
      periodSeconds: 10
    readiness:
      httpGet:
        path: /healthz
        httpHeaders: []
      initialDelaySeconds: 30
      timeoutSeconds: 3
      periodSeconds: 10
  variables:
    - name: postgres_db
      value: tp
    - name: postgres_user
      value: myuser
    - name: postgres_password
      valueFrom:
        secretKeyRef:
          name: db-secrets
          key: password
    - name: postgres_host
      value: db.mpa-database.svc.cluster.local